\ProvidesPackage{luacensor}
[2022/02/01
 Redact sensitive information using Lua]
% This work may be distributed and/or modified under the 
% conditions of the LaTeX Project Public License, either version 1.3 
% of this license or (at your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX 
% version 2005/12/01 or later.
%
% This work has the LPPL maintenance status `maintained'.
%
% The Current Maintainer of this work is Elijah Z Granet.
\RequirePackage{luacode}
\RequirePackage{fontspec}
%\newfontface\flowblock[Scale=1]{Flow Block}
\IfFontExistsTF{Flow Block}{\newfontface\cnsrfnt{Flow Block}
\newcommand{\onething}{\cnsrfnt*}
\newcommand{\twothings}{\cnsrfnt**}
\newcommand{\donothing}{}
}{
\newfontface\cnsrfnt[Scale=1.01%To allow for separate use of source sans in text
]{Source Sans Pro Black}
\newcommand{\onething}{\cnsrfnt▬}
\newcommand{\twothings}{\cnsrfnt▬▬}
\newcommand{\donothing}{}
}

\newif\ifcnsr\cnsrfalse
\newcommand{\cnsr}[1]{%
  \ifcnsr
{\renewcommand*{\kern}{}\renewcommand*{\itshape}{\cnsrfnt}\renewcommand*{\normalfont}{\cnsrfnt}\renewcommand{\bfseries}{\cnsrfnt}\renewcommand*{\ttfamily}{\cnsrfnt}
\renewcommand*{\sfdefault}{\cnsrfnt}\renewcommand*{\itdefault}{\cnsrfnt}
\renewcommand*{\rmdefault}{\cnsrfnt}\cnsrfnt\sloppy\rndstring{#1}}
  \else
   #1
  \fi
}



\begin{luacode}
--thanks to TeX.SE users Henri Menke and David Carlile
local function rndstring()
    local toks = token.scan_toks()
        local on = true
for n, t in ipairs(toks) do
    if t.csname == "begin" or t.csname == "end" then
       on = false
    end
   if not(on) and t.cmdname == "right_brace" then
     on = true
end
 if on and t.cmdname == "escape" then
local letter = token.create'donothing'
 toks[n] = letter 
elseif on and csname ==  "kern" then 
               local letter = token.create'donothing'
 toks[n] = letter
    elseif on and t.cmdname ==  "letter" then
            local f = math.random (1,20)
            if f == 1 then
               local letter = token.create'donothing'
 toks[n] = letter

            	elseif f == 2 then
               local letter = token.create'donothing'
 toks[n] = letter
 elseif f == 3 then
   local letter = token.create'donothing'  toks[n] = letter
 elseif f == 4 then
               local letter = token.create'twothings'
  toks[n] = letter
   elseif f == 5 then
   local letter = token.create'donothing'  toks[n] = letter

   else 
               local letter = token.create'onething'
 toks[n] = letter
            	end
            	          
            	elseif
            on and t.cmdname == "other_char" then
            local f = math.random (1,20)
            	if f == 2 then
               local letter = token.create'donothing'
 toks[n] = letter
         		            elseif f == 3 then
                    
               local letter = token.create'donothing'  toks[n] = letter
 elseif f == 4 then
 local letter = token.create'donothing'
  toks[n] = letter
           		            elseif f == 5 then
                    

               local letter = token.create'twothings'  toks[n] = letter
 elseif f == 6 then
                    

               local letter = token.create'donothing'  toks[n] = letter
                  elseif f == 7 then
   local letter = token.create'donothing'  toks[n] = letter


   else 
               local letter = token.create'onething'
 toks[n] = letter
 
            	end
                    end
    end
        token.put_next(toks)
end
local lft = lua.get_functions_table()
lft[#lft + 1] = rndstring
token.set_lua("rndstring", #lft, "global")
\end{luacode}